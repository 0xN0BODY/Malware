import sys
import io
import idautils
import idaapi


IDA_IMPORT_FILENAME = 'ida_import.txt'


def read_import_func_list():

    func_list = []

    with io.open(IDA_IMPORT_FILENAME, 'rt') as f:

        for line in f:
            s = line.strip()
            if (s == ''):
                continue
            fnc_entry = s.split('\t', 2)
            fnc_rva = int(fnc_entry[0], 16)
            if (fnc_rva != 0) and (fnc_entry[1] != ''):
                func_list.append((fnc_rva, fnc_entry[1]))

    return func_list
            

func_list = read_import_func_list()
print(str(len(func_list)) + ' import functions loaded.')

for fnc_entry in func_list:

    fnc_ea = fnc_entry[0] + ida_nalt.get_imagebase()
    ida_bytes.create_data(fnc_ea, ida_bytes.FF_DWORD, 4, BADADDR)
    ida_name.set_name(fnc_ea, fnc_entry[1],
                      ida_name.SN_FORCE | ida_name.SN_NOWARN)
